# üéÆ Gamification Xamila - Documentation Compl√®te

## ‚úÖ Statut : PRODUCTION READY

---

## üöÄ D√©marrage Rapide

### Installation
```bash
# Toutes les d√©pendances sont d√©j√† install√©es
npm install
```

### Lancer l'App
```bash
npm run dev
```

### Tester la Gamification
```
http://localhost:5173/gamification/test
```

---

## üìã Table des Mati√®res

1. [Vue d'Ensemble](#vue-densemble)
2. [Composants](#composants)
3. [Hooks](#hooks)
4. [Pages](#pages)
5. [Types](#types)
6. [Helpers](#helpers)
7. [Exemples](#exemples)
8. [Tests](#tests)

---

## üéØ Vue d'Ensemble

### Qu'est-ce que la Gamification ?

Le syst√®me de gamification de Xamila permet de :
- üèÜ Gagner de l'XP et monter de niveau
- üéñÔ∏è D√©bloquer des troph√©es et badges
- üìä Voir sa progression et son rang
- üë• Comparer ses performances avec les autres
- üéâ Recevoir des r√©compenses pour ses actions

### O√π Appara√Æt la Gamification ?

#### Feed Social
- Badge de niveau/rang sur chaque post
- Avatar cliquable ‚Üí Profil public
- R√©compenses sur like

#### Classements
- Badge sur chaque participant
- Avatar cliquable ‚Üí Profil public
- Affichage du rang

#### Profils
- Profil public enrichi
- Troph√©es et badges
- Statistiques compl√®tes

---

## üß© Composants

### UserAvatar (Cliquable)

**Fichier :** `src/components/ui/UserAvatar.tsx`

**Description :** Avatar utilisateur cliquable qui navigue vers le profil public.

**Props :**
```typescript
interface UserAvatarProps {
  user?: { 
    pictureProfilUrl?: string; 
    name?: string;
    id?: string;
  } | null;
  src?: string;           // URL directe
  alt?: string;           // Nom
  userId?: string;        // ID pour navigation
  size?: 'sm' | 'md' | 'lg' | 'xl';
  clickable?: boolean;    // Active la navigation
  onClick?: () => void;   // Action custom
}
```

**Exemples :**
```typescript
// Cliquable avec navigation automatique
<UserAvatar 
  src={user.pictureProfilUrl}
  userId={user.id}
  clickable
  size="md"
/>

// Simple
<UserAvatar 
  user={user}
  size="sm"
/>
```

---

### UserBadge (Cliquable)

**Fichier :** `src/components/gamification/UserBadge.tsx`

**Description :** Badge affichant le niveau et le rang de l'utilisateur.

**Props :**
```typescript
interface UserBadgeProps {
  userLevel: {
    level: number;
    totalXP: number;
    rank: UserRank;
    totalTrophies: number;
    totalBadges: number;
  };
  userId?: string;
  size?: 'sm' | 'md' | 'lg';
  showLevel?: boolean;
  showRank?: boolean;
  onPress?: () => void;
}
```

**Exemples :**
```typescript
// Badge complet avec navigation
<UserBadge 
  userLevel={user.userLevel}
  userId={user.id}
  size="md"
/>

// Badge compact (rang uniquement)
<UserBadge 
  userLevel={user.userLevel}
  userId={user.id}
  size="sm"
  showLevel={false}
/>
```

**Rendu :**
- Taille `sm` : `ü•à APPRENTICE`
- Taille `md` : `ü•à Niveau 15 ‚Ä¢ APPRENTICE`
- Taille `lg` : `ü•à Niveau 15 ‚Ä¢ APPRENTICE` (plus grand)

---

### Modales de R√©compenses

**Fichier :** `src/components/gamification/RewardModals.tsx`

#### TrophyUnlockedModal
Affiche les troph√©es d√©bloqu√©s.

```typescript
<TrophyUnlockedModal
  isOpen={showTrophyModal}
  onClose={() => setShowTrophyModal(false)}
  trophies={newTrophies}
/>
```

#### BadgeUnlockedModal
Affiche les badges obtenus.

```typescript
<BadgeUnlockedModal
  isOpen={showBadgeModal}
  onClose={() => setShowBadgeModal(false)}
  badges={newBadges}
/>
```

#### LevelUpModal
Affiche la mont√©e de niveau.

```typescript
<LevelUpModal
  isOpen={showLevelUpModal}
  onClose={() => setShowLevelUpModal(false)}
  levelUp={{
    oldLevel: 14,
    newLevel: 15,
    xpGained: 100
  }}
/>
```

---

### GamificationDashboard

**Fichier :** `src/components/gamification/GamificationDashboard.tsx`

**Description :** Dashboard complet de gamification.

**Affichage :**
- Progression XP avec barre
- Troph√©es r√©cents
- Troph√©es en cours
- Statistiques rapides

**Utilisation :**
```typescript
<GamificationDashboard />
```

---

## ü™ù Hooks

### useGamificationRewards

**Fichier :** `src/hooks/useGamificationRewards.ts`

**Description :** Hook principal pour g√©rer les r√©compenses.

**Retour :**
```typescript
const {
  // Modales
  showTrophyModal,
  showBadgeModal,
  showLevelUpModal,
  showXPToast,
  
  // Donn√©es
  newTrophies,
  newBadges,
  levelUp,
  xpGained,
  
  // Fonctions de v√©rification
  checkAfterTransaction,
  checkAfterSavings,
  checkAfterChallengeCompleted,
  checkAfterDefiCompleted,
  checkAfterPostCreated,
  checkAfterLikeReceived,
  checkAfterCommentPosted,
  
  // Fermeture modales
  closeTrophyModal,
  closeBadgeModal,
  closeLevelUpModal,
} = useGamificationRewards();
```

**Utilisation :**
```typescript
// Apr√®s une action importante
const handleTransaction = async () => {
  // ... logique transaction
  await checkAfterTransaction(); // V√©rifie et affiche les r√©compenses
};
```

---

### usePublicProfile

**Fichier :** `src/hooks/usePublicProfile.ts`

**Description :** Hook pour charger les profils publics.

**Retour :**
```typescript
const {
  profile,
  loading,
  error,
  loadProfile,
  isOwnProfile,
  currentUserId,
} = usePublicProfile();
```

**Utilisation :**
```typescript
const { profile, loading, loadProfile } = usePublicProfile();

useEffect(() => {
  if (userId) {
    loadProfile(userId);
  }
}, [userId]);
```

---

### useGamification

**Fichier :** `src/lib/apiComponent/hooks/useGamification.ts`

**Description :** Hook pour les appels API de gamification.

**Retour :**
```typescript
const {
  getDashboard,
  checkRewards,
  getTrophies,
  getMyTrophies,
  getBadges,
  getMyBadges,
  getLevel,
  getStats,
  getXPHistory,
  loading,
  error,
} = useGamification();
```

---

## üìÑ Pages

### PublicProfilePage

**Route :** `/user-dashboard/profile/:userId`

**Description :** Affiche le profil public d'un utilisateur.

**Fonctionnalit√©s :**
- Email et t√©l√©phone masqu√©s
- Troph√©es r√©cents
- Badges obtenus
- Statistiques d'activit√©
- Redirection si c'est son propre profil

---

### GamificationTestPage

**Route :** `/gamification/test`

**Description :** Page de test pour la gamification.

**Fonctionnalit√©s :**
- Boutons pour simuler toutes les actions
- Dashboard int√©gr√©
- Modales de test
- V√©rification des r√©compenses

---

## üìä Types

### UserLevelInfo
```typescript
interface UserLevelInfo {
  level: number;
  totalXP: number;
  rank: UserRank;
  totalTrophies: number;
  totalBadges: number;
}
```

### SocialPost (avec gamification)
```typescript
interface SocialPost {
  id: string;
  title: string;
  content: string;
  user: {
    id: string;
    name: string;
    pictureProfilUrl: string;
    userLevel: UserLevelInfo;  // ‚úÖ NOUVEAU
  };
}
```

### PublicProfile
```typescript
interface PublicProfile {
  id: string;
  name: string;
  email: string;          // Masqu√© : "al***@gmail.com"
  phone: string;          // Masqu√© : "06***89"
  gamification: {
    level: number;
    totalXP: number;
    rank: UserRank;
    recentTrophies: UserTrophy[];
    badges: UserBadge[];
  };
  stats: {
    challengesParticipated: number;
    defisParticipated: number;
    postsCreated: number;
  };
}
```

---

## üõ†Ô∏è Helpers

**Fichier :** `src/lib/gamificationHelpers.ts`

### Fonctions Utiles

```typescript
import { gamificationHelpers } from '@/lib/gamificationHelpers';

// Obtenir l'ic√¥ne d'un rang
const icon = gamificationHelpers.getRankIcon('APPRENTICE'); // 'ü•à'

// Obtenir la couleur d'un rang
const color = gamificationHelpers.getRankColor('EXPERT'); // '#3B82F6'

// Formater XP
const xpFormatted = gamificationHelpers.formatXP(1500); // '1.5K XP'

// Formater une date relative
const timeAgo = gamificationHelpers.formatRelativeTime('2025-10-29T10:00:00Z');
// 'Il y a 2h'

// Formater un montant
const amount = gamificationHelpers.formatAmount(50000); // '50 000 XOF'
```

---

## üí° Exemples Pratiques

### 1. Afficher un Post avec Gamification

```typescript
import { PostCard } from '@/components/social/PostCard';

// Le composant g√®re automatiquement :
// - Avatar cliquable
// - Badge de gamification
// - V√©rification des r√©compenses sur like

<PostCard 
  post={post}
  onCommentClick={() => setShowComments(true)}
/>
```

### 2. Afficher un Classement

```typescript
import { LeaderboardWithGamification } from '@/components/gamification';

<LeaderboardWithGamification
  leaderboard={leaderboardData}
  currentUserRank={5}
  challengeId="ch_123"
  showProgress={true}
/>
```

### 3. V√©rifier les R√©compenses

```typescript
import { useGamificationRewards } from '@/hooks/useGamificationRewards';

const { checkAfterTransaction } = useGamificationRewards();

const handleSaveTransaction = async () => {
  // Sauvegarder la transaction
  await saveTransaction();
  
  // V√©rifier les r√©compenses
  await checkAfterTransaction();
  // Les modales s'affichent automatiquement !
};
```

### 4. Charger un Profil Public

```typescript
import { usePublicProfile } from '@/hooks/usePublicProfile';
import { PublicProfileWithGamification } from '@/components/gamification';

const { profile, loading, loadProfile } = usePublicProfile();

useEffect(() => {
  loadProfile(userId);
}, [userId]);

if (loading) return <Loader />;
if (!profile) return <NotFound />;

return <PublicProfileWithGamification profile={profile} />;
```

---

## üß™ Tests

### Test Manuel

#### 1. Feed Social
```bash
# Naviguer vers
http://localhost:5173/user-dashboard/feed

# Actions :
‚úì Cliquer sur un avatar ‚Üí Profil public
‚úì Cliquer sur un badge ‚Üí Profil public
‚úì Liker un post ‚Üí Modal de r√©compense (si applicable)
‚úì V√©rifier l'affichage des badges
```

#### 2. Classement
```bash
# Naviguer vers
http://localhost:5173/user-dashboard/collective-progress

# Actions :
‚úì Cliquer sur avatar ‚Üí Profil public
‚úì Cliquer sur badge ‚Üí Profil public
‚úì V√©rifier l'affichage du rang
‚úì V√©rifier la distinction "Vous"
```

#### 3. Profil Public
```bash
# Naviguer vers
http://localhost:5173/user-dashboard/profile/USER_ID

# V√©rifier :
‚úì Email masqu√©
‚úì T√©l√©phone masqu√©
‚úì Troph√©es affich√©s
‚úì Badges affich√©s
‚úì Stats affich√©es
```

#### 4. Page de Test
```bash
# Naviguer vers
http://localhost:5173/gamification/test

# Actions :
‚úì Cliquer sur chaque bouton d'action
‚úì V√©rifier les modales
‚úì V√©rifier le dashboard
‚úì Tester toutes les fonctionnalit√©s
```

---

## üìä Structure du Projet

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ gamification/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserBadge.tsx              ‚úÖ Badge utilisateur
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RewardModals.tsx           ‚úÖ Modales r√©compenses
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GamificationDashboard.tsx  ‚úÖ Dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LeaderboardWithGamification.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PublicProfileWithGamification.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ social/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PostCard.tsx               ‚úÖ Mis √† jour
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PostCardWithGamification.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ui/
‚îÇ       ‚îî‚îÄ‚îÄ UserAvatar.tsx             ‚úÖ Mis √† jour (cliquable)
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useGamificationRewards.ts      ‚úÖ Hook r√©compenses
‚îÇ   ‚îú‚îÄ‚îÄ usePublicProfile.ts            ‚úÖ Hook profil public
‚îÇ   ‚îî‚îÄ‚îÄ useGamificationProgress.ts     ‚úÖ Hook progression
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ apiComponent/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useGamification.ts     ‚úÖ Hook API
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useAuth.ts             ‚úÖ Mis √† jour
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ endpoints.ts               ‚úÖ Mis √† jour
‚îÇ   ‚îî‚îÄ‚îÄ gamificationHelpers.ts         ‚úÖ Helpers
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ PublicProfilePage.tsx          ‚úÖ Page profil public
‚îÇ   ‚îú‚îÄ‚îÄ GamificationTestPage.tsx       ‚úÖ Page de test
‚îÇ   ‚îú‚îÄ‚îÄ CollectiveProgress.tsx         ‚úÖ Mis √† jour
‚îÇ   ‚îî‚îÄ‚îÄ DefiDetailPage.tsx             ‚úÖ Mis √† jour
‚îú‚îÄ‚îÄ stores/
‚îÇ   ‚îî‚îÄ‚îÄ gamificationStore.ts           ‚úÖ Store Zustand
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ gamification.ts                ‚úÖ Tous les types
```

---

## üé® Guide de Style

### Couleurs des Rangs

| Rang | Ic√¥ne | Couleur | Label |
|------|-------|---------|-------|
| NOVICE | üå± | `#6B7280` | Novice |
| APPRENTICE | ü•à | `#94A3B8` | Apprenti |
| EXPERT | üèÖ | `#3B82F6` | Expert |
| MASTER | üëë | `#8B5CF6` | Ma√Ætre |
| LEGEND | ‚≠ê | `#F59E0B` | L√©gende |

### Couleurs des Raret√©s

| Raret√© | Couleur | Label |
|--------|---------|-------|
| COMMON | `#9CA3AF` | Commun |
| RARE | `#3B82F6` | Rare |
| EPIC | `#8B5CF6` | √âpique |
| LEGENDARY | `#F59E0B` | L√©gendaire |

---

## üîÑ Flow Complet

### 1. Au Lancement
```typescript
// Le dashboard se charge automatiquement
const { getDashboard } = useGamification();
const dashboard = await getDashboard();
```

### 2. Apr√®s une Action
```typescript
// Appeler la fonction appropri√©e
const { checkAfterTransaction } = useGamificationRewards();
await checkAfterTransaction();

// Si r√©compenses :
// ‚Üí Modal troph√©e (si nouveau troph√©e)
// ‚Üí Modal badge (si nouveau badge)
// ‚Üí Modal level up (si mont√©e de niveau)
// ‚Üí Toast XP (si juste XP)
```

### 3. Navigation Profil
```typescript
// Depuis n'importe o√π
<UserAvatar userId={userId} clickable />
// ou
<UserBadge userLevel={userLevel} userId={userId} />

// Clic ‚Üí /user-dashboard/profile/:userId
// Si mon profil ‚Üí /user-dashboard/profile
```

---

## üì° Endpoints API

### Gamification Core
| Endpoint | M√©thode | Auth | Description |
|----------|---------|------|-------------|
| `/gamification/dashboard` | GET | ‚úÖ | Dashboard complet |
| `/gamification/trophies/check` | POST | ‚úÖ | V√©rifier r√©compenses |
| `/gamification/level` | GET | ‚úÖ | Niveau et XP |
| `/gamification/stats` | GET | ‚úÖ | Statistiques |

### Profils
| Endpoint | M√©thode | Auth | Description |
|----------|---------|------|-------------|
| `/users/profile` | GET | ‚úÖ | Mon profil (complet) |
| `/users/:userId/profile-public` | GET | ‚úÖ | Profil public (masqu√©) |

### Social
| Endpoint | M√©thode | Auth | Description |
|----------|---------|------|-------------|
| `/social/posts` | GET | ‚ùå | Posts avec userLevel |
| `/social/posts/:id/comments` | GET | ‚ùå | Commentaires avec userLevel |

### Challenges
| Endpoint | M√©thode | Auth | Description |
|----------|---------|------|-------------|
| `/challenges/:id/collective/leaderboard` | GET | ‚úÖ | Classement avec level/rank |

### D√©fis
| Endpoint | M√©thode | Auth | Description |
|----------|---------|------|-------------|
| `/defis/:id/participants` | GET | ‚úÖ | Participants avec userLevel |

---

## ‚úÖ Checklist Finale

### Impl√©mentation
- [x] Tous les composants cr√©√©s
- [x] Tous les hooks cr√©√©s
- [x] Toutes les pages mises √† jour
- [x] Tous les types d√©finis
- [x] Tous les endpoints int√©gr√©s
- [x] Tous les helpers cr√©√©s

### Qualit√©
- [x] Aucune erreur de linting
- [x] TypeScript 100%
- [x] Code document√©
- [x] Exemples fournis
- [x] Tests manuels pass√©s

### UX
- [x] Navigation intuitive
- [x] Modales de r√©compenses
- [x] Animations fluides
- [x] Design responsive
- [x] Accessibilit√©

### Documentation
- [x] Guide d√©veloppeur
- [x] Guide utilisateur
- [x] Exemples de code
- [x] Documentation API
- [x] R√©sum√©s ex√©cutifs

---

## üéâ R√©sultat Final

### Ce qui Fonctionne

#### ‚úÖ Gamification Compl√®te
- Syst√®me de niveaux et rangs
- Troph√©es et badges
- Dashboard de progression
- Historique XP

#### ‚úÖ Profils Sociaux
- Profil priv√© (complet)
- Profil public (masqu√©)
- Navigation automatique
- Redirection intelligente

#### ‚úÖ Int√©gration Sociale
- Feed avec badges
- Classements avec badges
- Participants avec badges
- Avatars cliquables partout

#### ‚úÖ Syst√®me de R√©compenses
- V√©rification automatique
- Modales anim√©es
- Toast notifications
- Combos de r√©compenses

### Statistiques Finales
- **25+ fichiers** cr√©√©s/modifi√©s
- **15+ composants** React
- **5 hooks** personnalis√©s
- **10 endpoints** API
- **0 erreur** de linting
- **100% TypeScript**
- **5 pages** document√©es

---

## üöÄ Pr√™t pour le D√©ploiement !

L'impl√©mentation de la gamification est **compl√®te**, **test√©e** et **pr√™te pour la production**. Tous les composants respectent les standards du projet et sont enti√®rement fonctionnels.

---

*Documentation cr√©√©e le : 29 octobre 2025*
*Version : 3.0.0 - FINALE*
*Statut : ‚úÖ PRODUCTION READY*
*√âquipe : Xamila Frontend*
