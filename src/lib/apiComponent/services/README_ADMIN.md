# üõ°Ô∏è API Admin - Documentation Compl√®te

## üìã Vue d'ensemble

Ce module impl√©mente toutes les API admin pour la gestion compl√®te de la plateforme Challenge d'√âpargne. Il inclut l'authentification admin, la gestion des utilisateurs, les statistiques, les param√®tres syst√®me, les comptes bancaires, les notifications et les ressources.

## üöÄ Installation et Utilisation

### Import des Hooks

```typescript
import {
  useAdminAuth,
  useAdminDashboard,
  useAdminUsers,
  useAdminSystemSettings,
  useAdminBankAccounts,
  useAdminNotifications,
  useAdminResources
} from '@/lib/apiComponent/hooks/useAdmin';
```

### Import des Services

```typescript
import { adminService } from '@/lib/apiComponent/services/adminService';
```

## üîê Authentification Admin

### Hook useAdminAuth

```typescript
const {
  isLoading,
  error,
  login,
  getProfile,
  changePassword
} = useAdminAuth();

// Connexion admin
const handleLogin = async () => {
  try {
    const response = await login({
      identifier: 'admin@challenge-epargne.com',
      password: 'Admin123!'
    });
    console.log('Connexion r√©ussie:', response);
  } catch (error) {
    console.error('Erreur de connexion:', error);
  }
};

// Changer le mot de passe
const handleChangePassword = async () => {
  try {
    await changePassword({
      currentPassword: 'AncienMotDePasse',
      newPassword: 'NouveauMotDePasse123!'
    });
  } catch (error) {
    console.error('Erreur:', error);
  }
};
```

## üìä Dashboard Admin

### Hook useAdminDashboard

```typescript
const {
  isLoading,
  error,
  getDashboardStats,
  getUserStats,
  getAdminStats
} = useAdminDashboard();

// Charger les statistiques du dashboard
useEffect(() => {
  const loadStats = async () => {
    try {
      const [dashboard, users, admins] = await Promise.all([
        getDashboardStats({ period: '30d' }),
        getUserStats(),
        getAdminStats()
      ]);
      
      console.log('Statistiques dashboard:', dashboard);
      console.log('Statistiques utilisateurs:', users);
      console.log('Statistiques admins:', admins);
    } catch (error) {
      console.error('Erreur:', error);
    }
  };

  loadStats();
}, []);
```

## üë• Gestion des Utilisateurs

### Hook useAdminUsers

```typescript
const {
  users,
  isLoading,
  error,
  pagination,
  getUsers,
  getPendingUsers,
  updateUser,
  toggleUserActive,
  toggleUserVerified,
  approveUser,
  rejectUser,
  upgradeUserToPremium,
  deleteUser
} = useAdminUsers();

// Charger les utilisateurs avec filtres
const loadUsers = async () => {
  try {
    await getUsers({
      page: 1,
      limit: 10,
      search: 'john',
      isPremium: true,
      approvalStatus: 'PENDING',
      sortBy: 'createdAt',
      sortOrder: 'desc'
    });
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Approuver un utilisateur
const handleApprove = async (userId: string) => {
  try {
    await approveUser(userId);
    console.log('Utilisateur approuv√©');
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Mettre √† niveau vers Premium
const handleUpgrade = async (userId: string) => {
  try {
    await upgradeUserToPremium(userId, {
      plan: 'PREMIUM',
      durationInDays: 30
    });
    console.log('Utilisateur mis √† niveau');
  } catch (error) {
    console.error('Erreur:', error);
  }
};
```

## ‚öôÔ∏è Param√®tres Syst√®me

### Hook useAdminSystemSettings

```typescript
const {
  settings,
  isLoading,
  error,
  getSettings,
  createSetting,
  updateSetting,
  deleteSetting
} = useAdminSystemSettings();

// Cr√©er un param√®tre
const handleCreateSetting = async () => {
  try {
    await createSetting({
      key: 'app_name',
      value: 'Challenge d\'√âpargne',
      type: 'string',
      description: 'Nom de l\'application',
      category: 'general',
      isPublic: true
    });
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Modifier un param√®tre
const handleUpdateSetting = async (key: string) => {
  try {
    await updateSetting(key, {
      value: 'Nouvelle valeur',
      type: 'string'
    });
  } catch (error) {
    console.error('Erreur:', error);
  }
};
```

## üè¶ Comptes Bancaires

### Hook useAdminBankAccounts

```typescript
const {
  applications,
  isLoading,
  error,
  getApplications,
  getApplicationStats,
  approveApplication,
  rejectApplication
} = useAdminBankAccounts();

// Charger les demandes
const loadApplications = async () => {
  try {
    await getApplications(1, 20, 'PENDING');
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Approuver une demande
const handleApprove = async (applicationId: string) => {
  try {
    await approveApplication(applicationId);
    console.log('Demande approuv√©e');
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Rejeter une demande
const handleReject = async (applicationId: string) => {
  try {
    await rejectApplication(applicationId, {
      notes: 'Documents insuffisants'
    });
    console.log('Demande rejet√©e');
  } catch (error) {
    console.error('Erreur:', error);
  }
};
```

## üîî Notifications

### Hook useAdminNotifications

```typescript
const {
  notifications,
  isLoading,
  error,
  broadcastNotification,
  getNotifications,
  getNotificationStats
} = useAdminNotifications();

// Diffuser une notification
const handleBroadcast = async () => {
  try {
    await broadcastNotification({
      title: 'Maintenance programm√©e',
      message: 'La plateforme sera en maintenance demain de 2h √† 4h',
      type: 'INFO',
      isUrgent: false
    });
    console.log('Notification diffus√©e');
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Charger les notifications
const loadNotifications = async () => {
  try {
    await getNotifications(1, 50, 'INFO', 'SENT');
  } catch (error) {
    console.error('Erreur:', error);
  }
};
```

## üìö Ressources

### Hook useAdminResources

```typescript
const {
  resources,
  isLoading,
  error,
  createResource,
  getResources,
  updateResource,
  deleteResource
} = useAdminResources();

// Cr√©er une ressource
const handleCreateResource = async () => {
  try {
    await createResource({
      title: 'Guide d\'√©pargne',
      description: 'Guide complet pour bien √©pargner',
      type: 'DOCUMENT',
      category: 'education',
      isPremium: true,
      url: 'https://example.com/guide.pdf',
      tags: ['√©pargne', 'guide', '√©ducation']
    });
  } catch (error) {
    console.error('Erreur:', error);
  }
};

// Modifier une ressource
const handleUpdateResource = async (resourceId: string) => {
  try {
    await updateResource(resourceId, {
      title: 'Nouveau titre',
      isPremium: false
    });
  } catch (error) {
    console.error('Erreur:', error);
  }
};
```

## üéØ Exemples d'Int√©gration

### Composant Dashboard Admin

```typescript
import { useAdminDashboard } from '@/lib/apiComponent/hooks/useAdmin';

const AdminDashboard = () => {
  const { getDashboardStats, isLoading, error } = useAdminDashboard();
  const [stats, setStats] = useState(null);

  useEffect(() => {
    const loadStats = async () => {
      try {
        const data = await getDashboardStats({ period: '30d' });
        setStats(data);
      } catch (error) {
        console.error('Erreur:', error);
      }
    };

    loadStats();
  }, []);

  if (isLoading) return <div>Chargement...</div>;
  if (error) return <div>Erreur: {error}</div>;

  return (
    <div>
      <h1>Dashboard Admin</h1>
      {stats && (
        <div>
          <p>Utilisateurs totaux: {stats.totalUsers}</p>
          <p>Utilisateurs premium: {stats.premiumUsers}</p>
          <p>Revenus totaux: {stats.totalRevenue} FCFA</p>
        </div>
      )}
    </div>
  );
};
```

### Composant Gestion Utilisateurs

```typescript
import { useAdminUsers } from '@/lib/apiComponent/hooks/useAdmin';

const UserManagement = () => {
  const {
    users,
    isLoading,
    getUsers,
    approveUser,
    rejectUser
  } = useAdminUsers();

  useEffect(() => {
    getUsers({ page: 1, limit: 10 });
  }, []);

  const handleApprove = async (userId: string) => {
    try {
      await approveUser(userId);
      // Rafra√Æchir la liste
      getUsers({ page: 1, limit: 10 });
    } catch (error) {
      console.error('Erreur:', error);
    }
  };

  return (
    <div>
      <h1>Gestion des Utilisateurs</h1>
      {isLoading ? (
        <div>Chargement...</div>
      ) : (
        <div>
          {users.map(user => (
            <div key={user.id}>
              <span>{user.name}</span>
              <button onClick={() => handleApprove(user.id)}>
                Approuver
              </button>
            </div>
          ))}
        </div>
      )}
    </div>
  );
};
```

## üîß Configuration

### Variables d'Environnement

Assurez-vous que les variables d'environnement suivantes sont configur√©es :

```env
VITE_API_BASE_URL=http://localhost:3000/api
VITE_ADMIN_API_BASE_URL=http://localhost:3000/api/admin
```

### Authentification

Les API admin n√©cessitent une authentification via JWT. Le token est automatiquement inclus dans les requ√™tes via le syst√®me d'authentification existant.

## üìù Types TypeScript

Tous les types sont export√©s depuis `@/types/admin` :

```typescript
import type {
  AdminUser,
  UserResponse,
  DashboardStats,
  SystemSetting,
  // ... autres types
} from '@/types/admin';
```

## üö® Gestion d'Erreurs

Tous les hooks incluent une gestion d'erreurs robuste :

```typescript
const { error, isLoading } = useAdminUsers();

if (error) {
  console.error('Erreur:', error);
  // Afficher un message d'erreur √† l'utilisateur
}

if (isLoading) {
  // Afficher un indicateur de chargement
}
```

## üîÑ Pagination

Les hooks qui g√®rent des listes incluent la pagination :

```typescript
const { pagination } = useAdminUsers();

console.log('Page actuelle:', pagination.page);
console.log('Total de pages:', pagination.totalPages);
console.log('Total d\'√©l√©ments:', pagination.total);
console.log('Page suivante disponible:', pagination.hasNext);
console.log('Page pr√©c√©dente disponible:', pagination.hasPrev);
```

## üé® Interface Utilisateur

Les composants d'exemple incluent :
- `AdminDashboardExample.tsx` - Dashboard avec statistiques en temps r√©el
- `UserManagementExample.tsx` - Gestion compl√®te des utilisateurs

Ces composants peuvent √™tre utilis√©s comme base pour cr√©er vos propres interfaces admin.

## üìö Endpoints Disponibles

Tous les endpoints sont d√©finis dans `endpoints.ts` :

- **Authentification** : `/admin/auth/login`, `/admin/profile`, `/admin/change-password`
- **Dashboard** : `/admin/dashboard`, `/admin/stats/users`, `/admin/stats/admins`
- **Utilisateurs** : `/admin/users`, `/admin/users/pending`, `/admin/users/:id/*`
- **Param√®tres** : `/admin/settings`, `/admin/settings/by-category`
- **Comptes bancaires** : `/admin/bank-accounts`, `/admin/bank-accounts/stats`
- **Notifications** : `/admin/notifications/broadcast`, `/admin/notifications`
- **Ressources** : `/admin/resources`, `/admin/resources/stats`

## üöÄ Prochaines √âtapes

1. Int√©grer les hooks dans vos composants admin existants
2. Personnaliser les interfaces selon vos besoins
3. Ajouter des fonctionnalit√©s suppl√©mentaires si n√©cessaire
4. Tester toutes les fonctionnalit√©s avec des donn√©es r√©elles

---

**Note** : Cette impl√©mentation est compl√®te et pr√™te √† l'emploi. Tous les endpoints du backend admin sont couverts et les hooks React facilitent l'int√©gration dans vos composants.
